---
import SectionHeader from './shared/SectionHeader.astro';
import FormInput from './shared/FormInput.astro';

const serviceOptions = [
    { value: 'landing', label: 'Landing Page' },
    { value: 'web', label: 'Firemný web' },
    { value: 'eshop', label: 'E-shop' },
    { value: 'custom', label: 'Iné' }
];
---

<section id="contact" class="py-24" aria-label="Kontaktný formulár">
    <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl p-8 md:p-12 reveal">
            <SectionHeader
                    title="Začnime spoluprácu"
                    description="Napíšte nám a my sa vám ozveme do 24 hodín"
            />

            <form id="contact-form" class="grid md:grid-cols-2 gap-6">
                <div class="md:col-span-1">
                    <FormInput label="Meno a priezvisko" name="name" required={true} />
                </div>
                <div class="md:col-span-1">
                    <FormInput label="Email" type="email" name="email" required={true} />
                </div>
                <div class="md:col-span-1">
                    <FormInput label="Telefón" type="tel" name="phone" />
                </div>
                <div class="md:col-span-1">
                    <FormInput
                            label="Typ služby"
                            type="select"
                            name="service"
                            required={true}
                            options={serviceOptions}
                    />
                </div>
                <div class="md:col-span-2">
                    <FormInput label="Správa" type="textarea" name="message" required={true} />
                </div>

                <!-- reCAPTCHA hidden field -->
                <input type="hidden" name="g-recaptcha-response" id="g-recaptcha-response" />

                <div class="md:col-span-2 text-center">
                    <button
                            type="submit"
                            class="inline-flex items-center justify-center px-8 py-4 bg-cyan-500 text-white font-semibold rounded-full hover:bg-cyan-600 transition duration-300"
                    >
                        Odoslať správu
                        <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
                        </svg>
                    </button>
                </div>
            </form>
        </div>
    </div>
</section>

<script src="https://www.google.com/recaptcha/api.js?render=6LeAlM4rAAAAAGxdb69dWiEQp2TaRv5qLxMMjzow"></script>

<script is:inline>
    document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("contact-form");
        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            grecaptcha.ready(async () => {
                const token = grecaptcha.execute("6LeAlM4rAAAAAGxdb69dWiEQp2TaRv5qLxMMjzow", {action: "submit"});
                document.getElementById("g-recaptcha-response").value = token;

                const res = await fetch("/api/contact", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        name: form.name.value,
                        email: form.email.value,
                        phone: form.phone.value,
                        service: form.service.value,
                        message: form.message.value,
                        token
                    })
                });

                const data = await res.json();
                alert(data.message);
                if (res.ok) form.reset();
            });
        });
    });
</script>
